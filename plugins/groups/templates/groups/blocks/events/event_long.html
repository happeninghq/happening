{% load group_permissions %}
{% load markdown_deux_tags %}
{% load tickets %}

{% if event.groups.count > 0 %}
    <h2>Groups</h2>
    <table class="groups" id="event-groups">
        {% for group in event.groups %}
            <tr>
                <th>
                    <a href="{{group.github_url}}">{{group.name}}</a>
                    {% if user|can_edit_group:group %}
                        <a href="{% url "edit_group" event.pk group.team_number %}">(edit)</a>
                    {% endif %}
                </th>
                {% if group.description %}
                    <td>{{group.description|markdown}}</td>
                {% else %}
                    <td></td>
                {% endif %}
                <td>
                    {% include "members/_list.html" with members=group.members %}
                    {% if user|has_tickets:event %}
                        {% if not user|has_group:event %}
                            <a href="{% url "join_group" event.pk group.team_number %}">join group</a>
                        {% endif %}
                        {% if user|group:event == group %}
                            <a href="{% url "leave_group" event.pk group.team_number %}">leave group</a>
                        {% endif %}
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        {% if not user|has_group:event %}
            <tr>
                <td colspan="3">
                    <a href="{% url "add_group" event.pk %}">Add a group</a>
                </td>
            </tr>
        {% endif %}
    </table>
{% endif %}

{% if not event.is_future %}
    {% if event.ungrouped_users|length > 0 %}
        <h2>Other attendees</h2>
        {% include "members/_list.html" with members=event.ungrouped_users %}
    {% endif %}
{% endif %}