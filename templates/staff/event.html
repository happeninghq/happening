{% extends "staff/base.html" %}
{% load plugins %}
{% load staticfiles %}

{% block staff_content %}
    <div class="container">
        <div class="row">
            <div class="small-12 column">
                <h3>{{event}}</h3>

                <a class="button" href="{% url "view_event" event.pk %}">View Event</a>

                <a class="button" href="{% url "edit_event" event.pk %}">Edit</a>
                <a class="button" href="{% url "email_event" event.pk %}">Send Email</a>
                <a class="button" href="{% url "manage_check_ins" event.pk %}">Manage Check Ins</a>

                {% plugin_block "staff.event.buttons" event %}

                <h3>Tickets</h3>
                <div>
                    <input type="search" id="filter_text" />
                </div>
                <table class="members tickets searchable" data-search-input="#filter_text">
                    <tr>
                        <th>Member</th>
                        <th>Tickets</th>
                        <th>Checked In</th>
                        {% plugin_block "staff.event.tickets.headers" event ticket %}
                        <th></th>
                    </tr>
                    {% for ticket in event.tickets.all %}
                        <tr {% if ticket.cancelled %}class="cancelled"{% endif %} data-searchable="{{ticket.user}} {{ticket.user.first_name}} {{ticket.user.last_name}}">
                            <td>
                                <a title="{{ticket.user.profile}}" href="{% url "view_profile" ticket.user.pk %}">
                                    {% include "members/_member_image.html" with member=ticket.user %}
                                </a>
                                <div><a title="{{ticket.user.profile}}" href="{% url "view_profile" ticket.user.pk %}">{{ticket.user}}</a></div>
                                <div><a title="{{ticket.user.profile}}" href="{% url "view_profile" ticket.user.pk %}">{{ticket.user.first_name}} {{ticket.user.last_name}}</a></div>
                            </td>
                            <td>
                                {{ticket.number}}
                                {% if ticket.cancelled %}(cancelled){% endif %}
                            </td>
                            <td>
                                {% if ticket.checked_in %}
                                    True<br />
                                    {{ticket.checked_in_datetime}}
                                {% else %}
                                    False
                                {% endif %}
                            </td>
                            {% plugin_block "staff.event.tickets.info" event ticket %}
                            <td>
                                <ul class="stack button-group">
                                    {% if not ticket.cancelled %}
                                        {% if event.is_future %}
                                            <li><a href="{% url "edit_ticket" ticket.id %}?redirect_to={% url "staff_event" event.id %}" class="button">Edit</a></li>
                                            <li><a href="{% url "cancel_ticket" ticket.id %}?redirect_to={% url "staff_event" event.id %}" class="button alert">Cancel</a></li>
                                        {% endif %}
                                        {% if ticket.checked_in %}
                                            <li><a href="{% url "cancel_check_in" ticket.id %}?redirect_to={% url "staff_event" event.id %}" class="button">Cancel Check In</a></li>
                                        {% else %}
                                            <li><a href="{% url "check_in" ticket.id %}?redirect_to={% url "staff_event" event.id %}" class="button">Check In</a></li>
                                        {% endif %}
                                    {% endif %}
                                    {% plugin_block "staff.event.tickets.options" event ticket %}
                                </ul>
                            </td>
                        </tr>
                    {% endfor %}
                </table>
                
                <a class="button" href="{% url "add_attendee" event.pk %}">Add Attendee</a>

                {% plugin_block "staff.event" event %}
            </div>
        </p>
    </div>
{% endblock %}

{% block scripts %}
<script type="text/coffeescript" src="{% static "coffeescript/search.coffee" %}"></script>
{% endblock %}