{% load xextends %}

{% xextends "staff/base.html" with secondary_nav="staff_events" %}
{% load plugins %}
{% load staticfiles %}

{% block staff_content %}
    <div class="l-container">
        <div class="l-primary-content block-list">
            <div class="block block-list__item">
                <header class="block__header">
                    <h2 class="block__header-text">Tickets</h2>
                </header>

                <table class="members tickets data-table" id="tickets-list">
                    <thead>
                        <tr>
                            <th></th>
                            <th>Username</th>
                            <th>Name</th>
                            <th>Tickets</th>
                            <th>Checked In</th>
                            {% plugin_block "staff.event.tickets.headers" event ticket %}
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for ticket in event.tickets.all %}
                            <tr {% if ticket.cancelled %}class="cancelled"{% endif %}>
                                <td>
                                    <a title="{{ticket.user.profile}}" href="{% url "view_profile" ticket.user.pk %}">
                                        <img class="members-list__image" src="{{ticket.user.profile.photo_url}}">
                                    </a>
                                </td>
                                <td>
                                    <a title="{{ticket.user.profile}}" href="{% url "view_profile" ticket.user.pk %}">{{ticket.user}}</a>
                                </td>
                                <td>
                                    {{ticket.user.first_name}} {{ticket.user.last_name}}
                                </td>
                                <td>
                                    {{ticket.number}}
                                    {% if ticket.cancelled %}(cancelled){% endif %}
                                </td>
                                <td>
                                    {% if ticket.checked_in %}
                                        True<br />
                                        {{ticket.checked_in_datetime}}
                                    {% else %}
                                        False
                                    {% endif %}
                                </td>
                                {% plugin_block "staff.event.tickets.info" event ticket %}
                                <td>
                                    <ul class="button-list">
                                        {% if not ticket.cancelled %}
                                            {% if event.is_future %}
                                                <li><a href="{% url "edit_ticket" ticket.id %}?redirect_to={% url "staff_event" event.id %}" class="btn">Edit</a></li>
                                                <li><a href="{% url "cancel_ticket" ticket.id %}?redirect_to={% url "staff_event" event.id %}" class="btn">Cancel</a></li>
                                            {% endif %}
                                            {% if ticket.checked_in %}
                                                <li><a href="{% url "cancel_check_in" ticket.id %}?redirect_to={% url "staff_event" event.id %}" class="btn">Cancel Check In</a></li>
                                            {% else %}
                                                <li><a href="{% url "check_in" ticket.id %}?redirect_to={% url "staff_event" event.id %}" class="btn">Check In</a></li>
                                            {% endif %}
                                        {% endif %}
                                        {% plugin_block "staff.event.tickets.options" event ticket %}
                                    </ul>
                                </td>
                            </tr>
                        {% endfor %}
                    </tbody>
                </table>
                
                <a class="btn" href="{% url "add_attendee" event.pk %}">Add Attendee</a>
            </div>

            {% plugin_block "staff.event" event %}
        </div>
        <div class="l-secondary-content block-list">
            
            {% include "staff/_tickets_filter_block.html" %}

            <div class="block block-list__item">
                <header class="block__header">
                    <h2 class="block__header-text block__header-text--small">{{event}}</h2>
                </header>

                <ul class="button-list">
                    <li><a class="btn" href="{% url "view_event" event.pk %}">View Event</a></li>
                    <li><a class="btn" href="{% url "edit_event" event.pk %}">Edit</a></li>
                    <li><a class="btn" href="{% url "email_event" event.pk %}">Send Email</a></li>
                    <li><a class="btn" href="{% url "manage_check_ins" event.pk %}">Manage Check Ins</a></li>
                    {% plugin_block "staff.event.buttons" event %}
                </ul>
            </div>
        </div>
    </div>
{% endblock %}